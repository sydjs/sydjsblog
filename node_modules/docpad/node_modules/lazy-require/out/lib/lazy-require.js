// Generated by CoffeeScript 1.6.3
var extractOpts, lazyRequire, safeps;

safeps = require('safeps');

extractOpts = require('extract-opts').extractOpts;

lazyRequire = {
  lazyRequire: function(name, opts, next) {
    var err, m, _ref;
    _ref = extractOpts(opts, next), opts = _ref[0], next = _ref[1];
    try {
      m = require(name);
    } catch (_error) {
      err = _error;
      m = null;
    }
    if (m) {
      return next(null, m);
    }
    return safeps.spawn(['npm', 'install', name], opts, function(err) {
      var _err;
      if (err) {
        return next(err, m);
      }
      try {
        m = require(name);
      } catch (_error) {
        _err = _error;
        return next(err, m);
      }
      return next(err, m);
    });
  }
};

module.exports = lazyRequire;
